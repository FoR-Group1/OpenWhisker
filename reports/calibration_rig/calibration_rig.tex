\documentclass[runningheads]{llncs}
\usepackage[T1]{fontenc}
\usepackage{float}
\usepackage{graphicx} % Required for inserting images
\usepackage{blindtext}
\usepackage[most]{tcolorbox}
\usepackage[colorlinks,linkcolor = black, citecolor=black,urlcolor=black,bookmarks=false,hypertexnames=true]{hyperref}
\bibliographystyle{splncs04}
\graphicspath{ {./figures/} }
\usepackage{subcaption}
\usepackage{wrapfig}
\usepackage{cite}
\setlength{\intextsep}{1pt}%
\setlength{\belowcaptionskip}{5pt}
\setlength{\abovecaptionskip}{5pt}
\usepackage{array}
\usepackage{tikz}
\newenvironment{conditions}
  {\par\vspace{\abovedisplayskip}\noindent\begin{tabular}{>{$}l<{$} @{${}={}$} l}}
  {\end{tabular}\par\vspace{\belowdisplayskip}}

\title{3D Printer Based Open Source Calibration Platform for Whisker Sensors\thanks{This work was partly supported by the Engineering and Physical Sciences
Research Council Grant [EP/S023917/1]}}

\author{
    Liyou Zhou\orcidID{0009-0005-9491-9003} \and
    Omar Ali \orcidID{0009-0009-3523-6084} \and
    Soumo Emmanuel Arnaud \and
    Eden Attenborough \and
    Jacob Swindell \and
    George Davies \and
    Charles Fox
}

\institute{School of Computer Science, University of Lincoln, Lincoln, UK}

\authorrunning{L. Zhou et al.}

\date{\today}

\begin{document}

\maketitle

\vspace{-10pt}

\begin{center}
    \url{https://zenodo.org/records/11081338}
    \url{https://github.com/FoR-Group1/OpenWhisker}
\end{center}

\begin{abstract}
\vspace{-5pt}
Whisker sensors have been an area of active research in recent years for their interesting use cases in tactile robotics and mammal physiology research. Several attempts have been made to develop open-source versions of the sensor to promote wider adoption. However, the existing calibration solutions for these sensors are highly proprietary, cost-prohibitive and error-prone. In this paper, we present a low-cost open-source calibration and testing platform for whisker sensors based on an off-the-shelf 3D printer. We demonstrate its effectiveness by calibrating a whisker sensor for radial contact distance inference. All artefacts of the design are open-sourced and are fully reproducible.
\keywords{Whisker Sensor \and Calibration \and Open-Source}
\vspace{-5pt}
\end{abstract}

\section{Introduction}

Whisker sensor is a type of tactile sensor that mimics the whiskers of rodents. It has been widely produced to study whiskered mammal physiology \cite{prescottActiveTouchSensing2020}. It has also garnered interest in the field of robotics in recent years as a low-cost and effective tactile sensor. \cite{fotouhiDetectionBarelyVisible2021} shows its use in material defect identification. \cite{struckmeierViTaSLAMBioinspiredVisuoTactile2019} and \cite{foxTactileSLAMBiomimetic2012} used whisker sensors in tactile SLAM tasks.

Existing research initiatives endeavour to build the whisker sensor and testing platform from scratch. This is time-consuming and often involves expensive proprietary hardware. For calibration, \cite{sullivanTactileDiscriminationUsing2012} and \cite{fotouhiDetectionBarelyVisible2021} used industrial robot arms to make the controlled movements required. \cite{evansWhiskerobjectContactSpeed2010} relied on a Yamaha-PXYX closed-source hardware Cartesian robot and a Yamaha RCX 222 controller, together costing several thousand pounds.

The cheap, accurate and repeatable calibration of whisker sensors is crucial for its wider adoption. While open-source sensor designs have been made available to researchers and hobbyists \cite{stevenson2024whisker}, no attempt has been made to provide a solution for sensor calibration. Our project sets out to fill this gap by developing a low-effort open-source whisker calibration and testing platform. We demonstrate the use of an off-the-shelf open-source 3D printer for automated and repeatable calibration.

\section{Solution Overview}

\subsection{Hardware Components}

The solution consists of the following hardware components:

\begin{enumerate}
    \item \textbf{3D Printer} A Prusa i3 (MK2)~\cite{OriginalPrusaI3} was used as the base for the platform.

    \item \textbf{Whisker Sensor Mount} A mount is 3D printed to secure the whisker sensor onto the printer bed. The base clamps onto the bed using grub screws. An adaptor is designed to hold the specific shape of the whisker sensor in place and allow for easy removal and replacement. The base features through-holes where the adaptor can be secured via zip ties.

    \item \textbf{Whisker Sensor} The whisker sensor used in our experimental setup is of a similar design to the one presented in \cite{stevenson2024whisker}. It consists of a 3d printed whisker shaft with a gel material at the base acting as a hinge. The whisker is $150 mm$ long and is tapered from base to the tip. A magnet is attached to the bottom of the shaft and a digital magnetometer is used to sense the displacement of the magnet. 

    \item \textbf{End Effector} Different end effectors can be mounted onto the printer head to make contact with the whisker sensor to carry out various calibration routines. For radial contact distance calibration, a metal ruler is mounted to make point contact with the whisker.
\end{enumerate}

\begin{figure}
    \centering
    \begin{tikzpicture}
        \node [anchor=south west,text width=2cm] (end_effector_mount) at (-1,4) {End Effector Mount};
        \node [anchor=north west] at (-1,4) {\includegraphics[height=60pt]{ruler_support.png}};

        \node [anchor=west] (ruler) at (-1,1) {Ruler};

        \node [anchor=south west] (sensor_mount) at (5.8,4.8) {Sensor Mount \& Adaptor};
        \node [anchor=north west] at (5.8,4.8) {\includegraphics[height=63pt]{whisker_mount_base.png}};
        \node [anchor=north west] at (8.3,4.8) {\includegraphics[height=63pt,trim={2.70pt 0 0 0},clip]{whisker_mount_adaptor.png}};

        \node [anchor=south west] (whisker_sensor) at (5.8,2) {Whisker Sensor};
        \node [anchor=north west] at (5.8,2) {\includegraphics[height=60pt, trim={0 0 3.3cm 0},clip]{whisker_cross_section.png}};

        \begin{scope}[xshift=1.5cm]
            \node[anchor=south west, inner sep=0] (image) at (0,0) {\includegraphics[height=140pt]{3d_printer_overview.jpg}};
            \begin{scope}[x={(image.south east)},y={(image.north west)}]
                \draw [-latex, ultra thick, red] (end_effector_mount) to[out=0, in=120] (0.33,0.60);
                \draw [-latex, ultra thick, red] (ruler) to[out=0, in=-120] (0.38,0.45);
                \draw [-latex, ultra thick, red] (sensor_mount) to[out=180, in=60] (0.6,0.6);
                \draw [-latex, ultra thick, red] (whisker_sensor) to[out=180, in=-60] (0.52,0.5);
            \end{scope}
        \end{scope}

    \end{tikzpicture}
    \caption{Calibration Platform Overview}
    \label{fig:overview}
\end{figure}
\vspace{-15pt}

\subsection{Software Components}

\subsubsection{Printer Control}

The printer natively supports a GCode~\cite{kramerNISTRS274NGCInterpreter2000} interface via a serial connection to a host computer. A Python API is written to interface with the printer and provide easy access to calibration routines. It provides functions to reset the printer to a known state and drive the printer head through a parameterized list of locations. The 3D coordinates of the printer head is also exposed via the API.

\subsubsection{Whisker Sensor Interface}

The whisker sensor uses a digital magnetometer to sense displacement. The magnetometer is read by a microcontroller and is in turn connected to the host computer via a serial port. The microcontroller prints the x, y and z readings to the serial port in hex format. The magnetometer has 16 bits per channel and is read at 800 Hz.

Different sensors will have different interfaces, hence a ROS 2 abstraction is provided so that the calibration routine can be easily adapted to different sensor designs.

\subsubsection{ROS integration}

The sensor and the calibration process, including the 3D printer, are integrated into the ROS 2 framework. The integration has the following main components:

\begin{itemize}
    \item \textbf{whisker\_driver\_node} Interfaces with the whisker sensor micro-controller via a serial port. Publishes data on a ROS topic.
    \item \textbf{printer\_driver\_node} Interfaces with the 3D printer, and drives it to go through a calibration sequence upon a ROS service call.
    \item \textbf{whisker\_interfaces} Message and service definitions for the drivers.
\end{itemize}

\begin{wrapfigure}{r}{.45\textwidth}
    \centering
    \includegraphics[width=.4\textwidth]{figures/foxglove_visualisation.png}
    \caption{Live visualization of the sensor system via Foxglove}
    \label{fig:foxglove}
\end{wrapfigure}

The nodes utilize standard ROS 2 messages and service definitions where possible. Interoperability is ensured through careful control of the interface messages. As a result, the project benefits from a wide range of open-source ROS 2 tools for data collection and analysis. The \verb|ros2_bag| utility is used to record data for calibration. \verb|foxglove| is used to visualize the data (Fig. \ref{fig:foxglove}) during development.

\section{Evaluation}

To demonstrate the effectiveness of the calibration platform, a whisker sensor is calibrated for radial contact distance inference. This is a crucial step in using the sensor for tactile SLAM \cite{pearsonSimultaneousLocalisationMapping2013, leporaNaiveBayesNovelty2010}. In this type of task, an array of whisker sensors is actuated to whisk back and forth. When the whisker makes contact with an obstacle, location of the contact point is estimated to build a map of the environment as the robot moves around.

Using the ROS 2 \textbf{printer\_driver\_node}, the printer head is driven to make contact with the whisker shaft at a series of known locations. The contact is made in a swift back-and-forth motion to mimic the whisking action. Data from the sensor as well as the 3D coordinates of the printer head is recorded via the ROS 2 \textbf{rosbag} utility. Fig.~\ref{fig:calibration_routine} shows the raw data collected from 3 consecutive calibration runs. The following analysis focuses on the y channel only as it contains the most significant signals, but the same process can be applied to the x and z channels.

\begin{figure}
    \centering
    \includegraphics[width=0.49\textwidth]{figures/raw_magnetometer.png}
    \hspace{1pt}
    \includegraphics[width=0.49\textwidth]{figures/3d_printer_raw.png}
    \caption{Raw Magnetometer (left) and 3D Printer Data (right) from 3 consecutive Calibration Routines}
    \label{fig:calibration_routine}
    \vspace{-10pt}
\end{figure}


\subsection{Calibration Data Processing}\label{sec:calibration_data_analysis}

\begin{wrapfigure}{r}{.46\textwidth}
    \centering
    \includegraphics[width=0.45\textwidth]{figures/filtered_magnetometer.png}
    \caption{Raw and Filtered Magnetometer Reading in the Y-Axis }
    \label{fig:filtered_magnetometer}
\end{wrapfigure}

A low-pass Butterworth filter is first applied to the sensor readings to reduce noise. A comparison of raw and filtered readings is shown in Fig.~\ref{fig:filtered_magnetometer}.

Each episode of contact is isolated and extracted from the time series. It is done by detecting a negative gradient in the sensor reading at the start of contact and a positive gradient at the end. 

During the routine, the printer head is always moving at a constant speed. In a realistic whisking motion, the shaft rotates around the base and the orthogonal speed \(\dot{y}\) is proportional to the distance from the base \(x\) and the angular speed \(\dot{\theta}\).
\begin{equation}\label{eq:linear_relationship}
\dot{y} = \dot{\theta}x
\end{equation}

To correct this difference, we scale the derivative of the sensor (\(\dot{y}\)) reading by a factor of \(x\) to simulate a constant angular velocity in all data. The corrected \(\dot{y}\) is plotted in Fig.~\ref{fig:corrected_derivative.png}.

\begin{figure}
    \centering
    \begin{subfigure}[t]{.49\textwidth}
        \centering
        \includegraphics[width=\columnwidth]{figures/corrected_derivative.png}
        \caption{Time series of \(\dot{y}\) of each Episode. The colour corresponds to the radial contact distance in $mm$.}
        \label{fig:corrected_derivative.png}
    \end{subfigure}
    \hspace{1pt}
    \begin{subfigure}[t]{.49\textwidth}
        \centering
        \includegraphics[width=\columnwidth]{figures/x_y_relationship.png}
        \caption{Nth data point of \(\dot{y}\) in each episode against the radial contact distance. The colour corresponds to the value of N}
        \label{fig:x_y_relationship.png}
    \end{subfigure}
    \caption{First derivative of \(y\) for each episode of contact}
    \label{fig:episode_analysis}
\end{figure}


There is a clear correlation between \(\dot{y}\) and the radial distance of the contact location \(x\). Fig. \ref*{fig:x_y_relationship.png} plots the Nth data point in each episode against the contact distance from the base of the whisker \(x\). Note that the relationship is non-linear as suggested by Eq.~\ref*{eq:linear_relationship}. This is because the deflection in \(y\) at the contact point has 2 components: \(y_{contact} = y_{twist} + y_{bend}\). \(y_{twist}\) is due to twisting of the gel material and \(y_{bend}\) is driven by bending of the whisker shaft.

While \(y_{twist}\) creates a directly proportional reading at the magnetometer sensor, the bending of the whisker shaft \(y_{bend}\) causes non-linearity. Hence, a non-linear model is required to model the relationship between \(x\) and \(\dot{y}\).

\begin{wrapfigure}{r}{.5\textwidth}
    \centering
    \includegraphics[width=.49\columnwidth]{figures/polynomial_regression.png}
    \caption{Polynomial Regression of the relationship between 120th sample of \(\dot{y}\) in each episode and the radial contact distance \(x\)}
    \label{fig:polynomial_regression.png}
\end{wrapfigure}

Picking the 120th sample in each episode, the relationship between \(x\) and \(\dot{y}\) is regressed using a third-order polynomial (Fig.~\ref*{fig:polynomial_regression.png}). The root mean squared error is $5.31 mm$ for the training set and $4.36 mm$ for the test set.  The largest error ($17.4 mm$) occurs towards the base of the whisker where the deflection is dominated by $y_{twist}$ and the correlation is weak. If a contact is made within $70 mm$ from the tip, the contact location can be accurately inferred to within $2 mm$ by the model.

The parameters of the polynomial are saved and used in \textbf{whisker driver node} to infer the contact location in real time. A polynomial model benefits from low compute resource requirement and is particularly suited for resource-constrained robotic applications with many whisker sensors.

\section{Conclusion}

As a result of the project, a fully re-producible cost-effective whisker sensor calibration and testing platform is developed and made available via open-source software and hardware. The utilization of a 3D printer as the main component drastically reduces the cost and barrier to reproduction. The integration with ROS 2 provides a convenient interface for data collection and analysis. We demonstrate the accurate and repeatable calibration of the whisker sensor in estimating the radial contact location. There is huge potential for further development based on the project's work, and we hope to see more people joining the effort. All project artefacts are available at \url{https://github.com/FoR-Group1/OpenWhisker}.

\bibliography{Whiskers.bib}

\end{document}
