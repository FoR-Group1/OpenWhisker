\documentclass[runningheads]{llncs}
\usepackage[T1]{fontenc}
\usepackage{float}
\usepackage{graphicx} % Required for inserting images
\usepackage{blindtext}
\usepackage[most]{tcolorbox}
\usepackage[colorlinks,linkcolor = black, citecolor=black,urlcolor=black,bookmarks=false,hypertexnames=true]{hyperref}
\bibliographystyle{splncs04}
\graphicspath{ {./figures/} }
\usepackage{subcaption}
\usepackage{wrapfig}
\setlength{\intextsep}{1pt}%
\setlength{\belowcaptionskip}{5pt}
\setlength{\abovecaptionskip}{5pt}

\title{3D Printer Based Open Source Calibration Platform for Whisker Sensors\thanks{This work was partly supported by the Engineering and Physical Sciences
Research Council Grant [EP/S023917/1]}}

\author{
    Liyou Zhou\orcidID{0009-0005-9491-9003} \and
    Omar Ali \and
    Emmanuel Soumo \and
    Eden Attenborough \and
    Jacob Swindell \and
    George Davies \and
    Charles Fox
}

\institute{School of Computer Science, University of Lincoln, Lincoln, UK}
%

\authorrunning{L. Zhou et al.}

\date{\today}

\begin{document}

\maketitle

\begin{abstract}
Whisker sensors is a type of tactile sensor that mimics the whiskers of animals. It has been an active area of research in recent years for its interesting use-cases in robotics and whiskered mammal physiology research. Several attempts have been made to develop an open source low cost version of the sensor to facilitate wider adoption. However, the calibration processes presented remain highly proprietary, time-consuming and error-prone. In this paper we present a low-cost open source whisker calibration platform based on a 3d printer to perform automated, high precision and repeatable calibration of whisker sensors. We propose a simple protocol for obtaining the relationship between the raw sensor readings (magnetometer) and the radial contact distance along the whisker. We demonstrate that the contact location can be inferred accurately with high frequency in real time. All artefact of the design is open sourced and fully reproducible.
\keywords{Whisker Sensor \and Calibration \and Open Source}
\end{abstract}

\section{Introduction}

Whisker sensors is a type of tactile sensor that mimics the whiskers of rodents. It has been an active area of research in recent years for its interesting use-cases in robotics and whiskered mammal physiology research\cite{prescottActiveTouchSensing2020}. \cite{fotouhiDetectionBarelyVisible2021} shows its use in material defect identification. \cite{struckmeierViTaSLAMBioinspiredVisuoTactile2019} and \cite{foxTactileSLAMBiomimetic2012} demonstrates its successful use in SLAM tasks. When used in mobile robots, numerous whiskers are combined into an array \cite{leporaNaiveBayesNovelty2010} \cite{pearsonSimultaneousLocalisationMapping2013}. The fast, accurate and repeatable calibration of the whisker sensors is crucial for the success of the robot.

Existing research initiatives endeavour to build the whisker sensor and testing platform from scratch. This is a time-consuming and expensive process. A number of initiatives have made available open source whisker sensor designs \cite{FoRGroup1OpenWhisker2024} \cite{RatatouilleWhiskersOpenWhiskerOpen}. However, the calibration processes presented require building very specific calibration rigs and hence remain cost prohibitive and error-prone. 

Our project set out to fill this gap by developing a low-effort open source whisker sensor calibration and testing platform. We demonstrate the use of an off-the-shelf open source 3d printer as an automated and repeatable calibration rig for whisker sensors.

\section{Solution Overview}

\subsection{Hardware Components}

\begin{wrapfigure}{r}{0.4\textwidth}
    \centering
    \includegraphics[width=0.4\textwidth]{3d_printer_overview.jpg}
    \caption{3D Printer based Calibration Rig consisting of a 3D printer, whisker sensor mount and end effector mount.}
    \vspace{-5pt}
    \label{fig:calibration_rig_overview}
\end{wrapfigure}

An overview of the hardware setup can be seen in Fig.~\ref{fig:calibration_rig}. The solution is built around the following main components:

\begin{enumerate}
    \item \textbf{3D Printer} A Original Prusa i3~\cite{OriginalPrusaI3} was used as the base for the calibration rig.
    \item \textbf{Whisker Sensor Mount} An 3d printable adaptor is designed to mount the specific whisker sensor used in the project onto the printer bed. Illustrated in Fig.~\ref{fig:whisker_mount_base}, the base mounts to the bed using grub screws. The adaptor is designed to hold the specific shape of the whisker sensor in place and allow for easy removal and replacement of the sensor. The base is designed with mounting holes where the adaptor can be secured via zip ties.
    \item \textbf{End Effector} Different end effectors can be mounted onto the printer head to make contact with the whisker sensor in order to carry out various calibration routines. For contact distance calibration, a metal ruler is mounted to make point contact with the whisker.
\end{enumerate}

\begin{figure}
    \begin{subfigure}{.32\textwidth}
    \centering
    \includegraphics[width=0.9\textwidth]{whisker_mount_base.png}
        \caption{whisker mount base}
        \label{fig:whisker_mount_base}
    \end{subfigure}
    \begin{subfigure}{.32\textwidth}
        \centering
        \includegraphics[width=0.9\textwidth]{whisker_mount_adaptor.png}
        \caption{Whisker sensor adaptor}
        \label{fig:whisker_mount_adaptor}
    \end{subfigure}
    \begin{subfigure}{.32\textwidth}
        \centering
        \includegraphics[width=0.9\textwidth]{beam_monunt.png}
        \caption{End effector mount}
        \label{fig:beam_monunt}
    \end{subfigure}
    \caption{3D printed mounts and adaptors}
    \label{fig:calibration_rig}
\end{figure}

\subsection{Software Components}

\subsubsection{Printer Control}

The printer natively supports a GCode~\cite{kramerNISTRS274NGCInterpreter2000} interface via a serial connection to a host computer. A python API is written to interface with the printer and provide easy access to calibration routines. It provides functions to reset the printer to a known state and drive the printer head through a parameterized list of locations with a single function call. It also provides functions to read the x, y, z position of the printer head.

\subsubsection{Whisker Sensor Interface}

The whisker sensor used to demonstrate the calibration platform uses a digital magnetometer to sense displacement. The magnetometer is read by a micro-controller and is in-term connected to the host computer via a serial port. The micro-controller prints the x, y, z readings to serial port in hex format. Different sensors will have different interfaces, hence we provide a ROS 2 abstraction so that the calibration routine can be easily adapted to different sensor implementations.

\subsubsection{ROS integration}

The sensor and the calibration process, including the 3d printer are integrated into the ROS 2 framework. The integration has the following main components:

\begin{itemize}
    \item \textbf{whisker\_driver\_node} Interfaces with the whisker sensor micro-controller via a serial port. Publishes data on a ROS topic.
    \item \textbf{printer\_driver\_node} Interfaces with the 3d printer, drive it to go through a calibration sequence upon a ROS service call.
    \item \textbf{whisker\_interfaces} Message and service definitions for the drivers.
\end{itemize}

\begin{wrapfigure}{r}{.5\textwidth}
    \centering
    \includegraphics[width=.48\textwidth]{figures/foxglove_visualisation.png}
    \caption{Foxglove visualization of whisker sensor system running in ROS 2}
    \label{fig:foxglove}
\end{wrapfigure}

The nodes are written to use standard ROS2 message and service definitions as much as possible. Interoperability is ensured through careful control of the interface messages. As a result, the project benefits from a wide range of open source ROS 2 tools for data collection and analysis. The \verb|ros2 bag| utility is used to record data from the nodes for calibration. \verb|foxglove| is used to visualize the data (Fig. \ref{fig:foxglove}) during development.

\section{Evaluation}

To demonstrate the effectiveness of the calibration rig, we implement a calibration routine to enable a whisker sensor to infer the radial contact location along the whisker. This is a crucial step in making the sensor useful in SLAM tasks. In these tasks, e.g. \cite{pearsonSimultaneousLocalisationMapping2013} \cite{leporaNaiveBayesNovelty2010}, an array of whisker sensors are driven by a servo motor to whisk back and forth. The contact location is inferred in real time to build a map of the environment as the robot moves around.

Using the ROS 2 \textbf{printer\_driver\_node}, the printer is instructed to make contact with the whisker shaft at a series of known locations. The contact is made in a swift back and forth motion to mimic whisking action. Readings from the sensor as well as the 3d position of the printer head is easily recorded via the ROS 2 \textbf{rosbag} utility. Fig.~\ref{fig:calibration_routine} shows the raw data collected from 3 consecutive calibration runs.

\begin{figure}
    \centering
    \includegraphics[width=0.49\textwidth]{figures/raw_magnetometer.png}
    \includegraphics[width=0.49\textwidth]{figures/3d_printer_raw.png}
    \caption{Raw Magnetometer (left) and 3D Printer Data (right) from 3 consecutive Calibration Routines}
    \label{fig:calibration_routine}
\end{figure}

\vspace{-10pt}

\subsection{Calibration Data Processing}\label{sec:calibration_data_analysis}

\begin{wrapfigure}{r}{.5\textwidth}
    \centering
    \includegraphics[width=0.48\textwidth]{figures/filtered_magnetometer.png}
    \caption{Raw and Filtered Magnetometer Reading in the X Axis }
    \label{fig:filtered_magnetometer}
\end{wrapfigure}

The raw magnetometer readings are noisy, hence as a first step, a low pass Butterworth filter is applied to the data. A comparison of raw and filtered data is shown in Fig.~\ref{fig:filtered_magnetometer}.

In the next step, each episode of contact is isolated and extracted from the time series. It is done by detecting a negative speed at the start of contact and a positive speed at the end of the episode in the y direction of the magnetometer readings.

Each episode contains only the forward whisk. In a realistic whisking scenario, contact can be made any time within a whisking period. A detection algorithm should be able to detect contact with as little data as possible to minimize latency.

During the routine, the printer header is always moving at a constant speed. In a realistic whisking motion, the shaft rotates around the base and the orthogonal speed \(\dot{y}\) is proportional to the distance from the base \(x\) and the angular speed \(\dot{\theta}\).

\begin{equation}\label{eq:linear_relationship}
\dot{y} = \dot{\theta}x
\end{equation}

To correct for this effect, we scale the derivative of sensor reading by a factor of \(x\) to simulate a constant angular velocity in all data. The corrected derivative of sensor reading is plotted in Fig.~\ref{fig:corrected_derivative.png}.

\begin{figure}
    \centering
    \begin{subfigure}[t]{.48\textwidth}
        \centering
        \includegraphics[width=\columnwidth]{figures/corrected_derivative.png}
        \caption{Corrected \(\dot{y}\) of the Isolated Contact Episodes. Each episode is 1 line and the color corresponds to the distance from the base of the whisker \(x\) where contact is made}
        \label{fig:corrected_derivative.png}
    \end{subfigure}
    \hspace{1mm}
    \begin{subfigure}[t]{.48\textwidth}
        \centering
        \includegraphics[width=\columnwidth]{figures/x_y_relationship.png}
        \caption{Nth data point of \(\dot{y}\) in each episode against the distance from the base of the whisker \(x\) where contact is made. The color corresponds to the value of N}
        \label{fig:x_y_relationship.png}
    \end{subfigure}
    \vspace{-5pt}
    \caption{First derivative of \(y\) for each episode of contact}
    \label{fig:episode_analysis}
\end{figure}

It can be seen there is a clear correlation between \(\dot{y}\) and \(x\). Fig. \ref*{fig:x_y_relationship.png} plots the Nth data point in each episode against the contact distance from the base of the whisker \(x\). It can be noted that the relationship is not linear as suggested by Eq.~\ref*{eq:linear_relationship}. This is because the deflection in \(y\) at the contact point of the whisker has 2 components:
\begin{itemize}
    \item Displacement due to twisting of the gel material \(y_{twist}\).
    \item Displacement due to bending of the whisker shaft \(y_{bend}\).
\end{itemize}
\[y_{contact} = y_{twist} + y_{bend}\]

\begin{wrapfigure}{r}{.5\textwidth}
    \centering
    \includegraphics[width=.45\textwidth]{figures/polynomial_regression.png}
    \caption{Polynomial Regression of the relationship 100th sample of \(\dot{y}\) in each episode and the contact distance \(x\)}
    \label{fig:polynomial_regression.png}
\end{wrapfigure}

While \(y_{twist}\) creates a directly proportional reading at the magnetometer sensor, the bending of the whisker shaft \(y_{bend}\) causes non-linearity. Hence, a non-linear model is required to model the relationship between \(x\) and \(\dot{y}\).

Picking the 120th sample in each episode, this relationship between \(x\) and \(\dot{y}\) is modelled using a third order polynomial via a least-square regression algorithm. Fig. \ref*{fig:polynomial_regression.png} plots the final fitted curve.

The parameters of the polynomial is saved and used in the whisker driver node to infer the contact location in real time. The benefit of a polynomial model is that it is very quick to compute. On a resource constrained robotic application with many whisker sensors, such a low-demand algorithm is desirable.

\section{Conclusion}

As a result of the project, a fully re-producible cost-effective whisker sensor calibration rig is developed and made available via open source software and hardware. The utilization of a 3d printer as the main component drastically reduces the cost and barrier to reproduction. The integration with ROS 2 provides a convenient interface for data collection and analysis. We demonstrate the accurate and repeatable calibration of the whisker sensor in estimating the radial contact location. There is huge potential in further development based on the project's work, and we hope to see more people joining the effort. All project artifacts can be viewed at: \url{https://github.com/FoR-Group1/OpenWhisker}.

\bibliography{Whiskers.bib}

\end{document}
